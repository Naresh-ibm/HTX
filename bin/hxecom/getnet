#!/usr/bin/perl
# @(#)68	1.2  src/htx/usr/lpp/htx/bin/hxecom/getnet, exer_com, htxubuntu 5/24/04 10:15:23
#########################################################################
#make sure this is root user. 
$SERVER=$ARGV[0];

if($SERVER eq "") {
	$SERVER="iofnim.austin.ibm.com";	
}


#see if the server is up..
$res = `ping -c1 -w1 $SERVER`;
if($res =~ /100%/) {
	if($SERVER !~ /austin/) {
		$SERVER = "$SERVER" . ".austin.ibm.com";
		$res = `ping -c1 -w1 $SERVER`;
		if($res !~ /100%/) {
		} else {
			print("$SERVER is NOT up.. You may have to put $SERVER in /etc/hosts file\n");
			print("You may also need to try another server.. try toro or bu51b\n");
			print("Just give the new server as input parm ex: getnet bu51b\n");
			exit(1);
		}
	} else {
		print("$SERVER is NOT up.. You may have to put $SERVER in /etc/hosts file\n");
		print("You may also need to try another server.. try toro or bu51b\n");
		print("Just give the new server as input parm ex: getnet bu51b\n");
		exit(1);
	}
}

#make sure /mnt is not already mounted.
$res = `umount /mnt > /dev/null 2>&1`;
# Now mount the build_net dir on SERVER
print("Mount $SERVER:/nim/build_net\n");
$res = `mount $SERVER:/nim/build_net /mnt`;
$res = `echo $?`;
if($res != "0") {
    print("\nMount Failed rc=$res\n");
	&do_exit();
}

#is this linux
$linux="";
$res = `uname -r`;
chomp($res);
$len = length($res);
if($len > 10) {
	print("Get the linux version of the build_net package\n");
    $linux="yes";
} else {
	print("Get the AIX version of the build_net package\n");
}

chdir("/");
if($linux) {
	$res = `tar -xvf/mnt/linux/bld_net.tar`;
	print("$res");
} else {
	$res = `restore -xMqf/mnt/bld_net.bak`;
	print("$res");
	&set_prof();
}

&do_exit();

sub do_exit {
	$res = `umount /mnt > /dev/null 2>&1`;
	exit 0;
}
sub set_prof() {
	
	$res="";
	$res=`ls /.profile`;
	if($res eq "") {
		$chk = `cp /bn.profile /.profile`;
	}
	$res="";
	$res=`ls /.kshrc`;
	if($res eq "") {
		$chk = `cp /bn.kshrc /.kshrc`;
	}
	$res="";
	$res=`ls /.alias`;
	if($res eq "") {
		$chk = `cp /bn.alias /.alias`;
	}
	$res="";
	$res=`ls /.rhosts`;
	if($res eq "") {
		$chk = `cp /bn.rhosts /.rhosts`;
	} else {
		$chk = `cat /bn.rhosts >> /.rhosts`;
	}
}

